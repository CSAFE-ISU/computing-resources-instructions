<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 8 Batch Jobs | CSAFE Computing Resources</title>
  <meta name="description" content="This book gives the reader step-by-step instuctions for accessing and using CSAFE computing resources." />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 8 Batch Jobs | CSAFE Computing Resources" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This book gives the reader step-by-step instuctions for accessing and using CSAFE computing resources." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 8 Batch Jobs | CSAFE Computing Resources" />
  
  <meta name="twitter:description" content="This book gives the reader step-by-step instuctions for accessing and using CSAFE computing resources." />
  

<meta name="author" content="Stephanie Reinders" />


<meta name="date" content="2022-06-07" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="interactive-sessions.html"/>
<link rel="next" href="pronto-commands.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Minimal Book Example</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="connecting-from-off-campus.html"><a href="connecting-from-off-campus.html"><i class="fa fa-check"></i><b>2</b> Connecting from off campus</a>
<ul>
<li class="chapter" data-level="2.1" data-path="connecting-from-off-campus.html"><a href="connecting-from-off-campus.html#install-vpn"><i class="fa fa-check"></i><b>2.1</b> Install the ISU Virtual Private Network (VPN)</a></li>
<li class="chapter" data-level="2.2" data-path="connecting-from-off-campus.html"><a href="connecting-from-off-campus.html#ssh-keys"><i class="fa fa-check"></i><b>2.2</b> Generate SSH keys</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="cross.html"><a href="cross.html"><i class="fa fa-check"></i><b>3</b> Cross-references</a>
<ul>
<li class="chapter" data-level="3.1" data-path="cross.html"><a href="cross.html#chapters-and-sub-chapters"><i class="fa fa-check"></i><b>3.1</b> Chapters and sub-chapters</a></li>
<li class="chapter" data-level="3.2" data-path="cross.html"><a href="cross.html#captioned-figures-and-tables"><i class="fa fa-check"></i><b>3.2</b> Captioned figures and tables</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="parts.html"><a href="parts.html"><i class="fa fa-check"></i><b>4</b> Parts</a></li>
<li class="chapter" data-level="5" data-path="pronto.html"><a href="pronto.html"><i class="fa fa-check"></i><b>5</b> Pronto</a>
<ul>
<li class="chapter" data-level="5.1" data-path="pronto.html"><a href="pronto.html#pronto"><i class="fa fa-check"></i><b>5.1</b> Connecting to the Pronto job scheduler</a></li>
<li class="chapter" data-level="5.2" data-path="pronto.html"><a href="pronto.html#prontodtn"><i class="fa fa-check"></i><b>5.2</b> Connecting to the Pronto data transfer node</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="pronto.html"><a href="pronto.html#transfering-large-amounts-of-data-using-globus"><i class="fa fa-check"></i><b>5.2.1</b> Transfering large amounts of data using Globus</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="running-an-r-script-on-pronto.html"><a href="running-an-r-script-on-pronto.html"><i class="fa fa-check"></i><b>6</b> Running an R script on Pronto</a></li>
<li class="chapter" data-level="7" data-path="interactive-sessions.html"><a href="interactive-sessions.html"><i class="fa fa-check"></i><b>7</b> Interactive Sessions</a>
<ul>
<li class="chapter" data-level="7.1" data-path="interactive-sessions.html"><a href="interactive-sessions.html#ex-start-interactive"><i class="fa fa-check"></i><b>7.1</b> Example: Start an interactive session</a></li>
<li class="chapter" data-level="7.2" data-path="interactive-sessions.html"><a href="interactive-sessions.html#ex-interactive-install"><i class="fa fa-check"></i><b>7.2</b> Example: Install dplyr package</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="batch-jobs.html"><a href="batch-jobs.html"><i class="fa fa-check"></i><b>8</b> Batch Jobs</a>
<ul>
<li class="chapter" data-level="8.1" data-path="batch-jobs.html"><a href="batch-jobs.html#ex-basic"><i class="fa fa-check"></i><b>8.1</b> Example: A basic R script</a></li>
<li class="chapter" data-level="8.2" data-path="batch-jobs.html"><a href="batch-jobs.html#ex-save"><i class="fa fa-check"></i><b>8.2</b> Example: Save a dataframe to a CSV file</a></li>
<li class="chapter" data-level="8.3" data-path="batch-jobs.html"><a href="batch-jobs.html#ex-load"><i class="fa fa-check"></i><b>8.3</b> Example: Load data from a CSV file</a></li>
<li class="chapter" data-level="8.4" data-path="batch-jobs.html"><a href="batch-jobs.html#ex-batch-install"><i class="fa fa-check"></i><b>8.4</b> Example: Install R packages</a></li>
<li class="chapter" data-level="8.5" data-path="batch-jobs.html"><a href="batch-jobs.html#ex-parallel"><i class="fa fa-check"></i><b>8.5</b> Example: Run code in parallel</a></li>
<li class="chapter" data-level="8.6" data-path="batch-jobs.html"><a href="batch-jobs.html#ex-seed"><i class="fa fa-check"></i><b>8.6</b> Example: Set the seed for the random number generator</a></li>
<li class="chapter" data-level="8.7" data-path="batch-jobs.html"><a href="batch-jobs.html#ex-packages-parallel"><i class="fa fa-check"></i><b>8.7</b> Example: Use functions from dplyr and magrittr in parallel</a></li>
<li class="chapter" data-level="8.8" data-path="batch-jobs.html"><a href="batch-jobs.html#example-use-a-user-defined-function-to-save-results-inside-a-parallel-loop"><i class="fa fa-check"></i><b>8.8</b> Example: Use a user-defined function to save results inside a parallel loop</a></li>
<li class="chapter" data-level="8.9" data-path="batch-jobs.html"><a href="batch-jobs.html#ex-log"><i class="fa fa-check"></i><b>8.9</b> Example: Create a log file</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="pronto-commands.html"><a href="pronto-commands.html"><i class="fa fa-check"></i><b>9</b> Pronto Commands</a>
<ul>
<li class="chapter" data-level="9.1" data-path="pronto-commands.html"><a href="pronto-commands.html#list-loaded-modules"><i class="fa fa-check"></i><b>9.1</b> List loaded modules</a></li>
<li class="chapter" data-level="9.2" data-path="pronto-commands.html"><a href="pronto-commands.html#purge-all-loaded-modules"><i class="fa fa-check"></i><b>9.2</b> Purge all loaded modules</a></li>
<li class="chapter" data-level="9.3" data-path="pronto-commands.html"><a href="pronto-commands.html#view-your-jobs-in-the-pronto-queue"><i class="fa fa-check"></i><b>9.3</b> View your job(s) in the Pronto queue</a></li>
<li class="chapter" data-level="9.4" data-path="pronto-commands.html"><a href="pronto-commands.html#cancel-a-job"><i class="fa fa-check"></i><b>9.4</b> Cancel a job</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="install-the-handwriter-package.html"><a href="install-the-handwriter-package.html"><i class="fa fa-check"></i><b>10</b> Install the handwriter package</a></li>
<li class="chapter" data-level="11" data-path="trouble-shooting.html"><a href="trouble-shooting.html"><i class="fa fa-check"></i><b>11</b> Trouble-Shooting</a>
<ul>
<li class="chapter" data-level="11.1" data-path="trouble-shooting.html"><a href="trouble-shooting.html#ex-line-breaks"><i class="fa fa-check"></i><b>11.1</b> Line breaks error</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="blocks.html"><a href="blocks.html"><i class="fa fa-check"></i><b>12</b> Blocks</a>
<ul>
<li class="chapter" data-level="12.1" data-path="blocks.html"><a href="blocks.html#equations"><i class="fa fa-check"></i><b>12.1</b> Equations</a></li>
<li class="chapter" data-level="12.2" data-path="blocks.html"><a href="blocks.html#theorems-and-proofs"><i class="fa fa-check"></i><b>12.2</b> Theorems and proofs</a></li>
<li class="chapter" data-level="12.3" data-path="blocks.html"><a href="blocks.html#callout-blocks"><i class="fa fa-check"></i><b>12.3</b> Callout blocks</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="sharing-your-book.html"><a href="sharing-your-book.html"><i class="fa fa-check"></i><b>13</b> Sharing your book</a>
<ul>
<li class="chapter" data-level="13.1" data-path="sharing-your-book.html"><a href="sharing-your-book.html#publishing"><i class="fa fa-check"></i><b>13.1</b> Publishing</a></li>
<li class="chapter" data-level="13.2" data-path="sharing-your-book.html"><a href="sharing-your-book.html#pages"><i class="fa fa-check"></i><b>13.2</b> 404 pages</a></li>
<li class="chapter" data-level="13.3" data-path="sharing-your-book.html"><a href="sharing-your-book.html#metadata-for-sharing"><i class="fa fa-check"></i><b>13.3</b> Metadata for sharing</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">CSAFE Computing Resources</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="batch-jobs" class="section level1" number="8">
<h1><span class="header-section-number">Chapter 8</span> Batch Jobs</h1>
<div id="ex-basic" class="section level2" number="8.1">
<h2><span class="header-section-number">8.1</span> Example: A basic R script</h2>
<ol style="list-style-type: decimal">
<li><p>If you are off campus, connect to the ISU VPN (see <a href="#signin-vpn"><strong>??</strong></a>)</p></li>
<li><p>Sign-in to Pronto (see <a href="pronto.html#pronto">5</a>).</p></li>
<li><p>Open your csafe-lab work folder <code>prontodtn.las.iastate.edu &gt; work &gt; LAS &gt; csafe-lab &gt; your_netid</code> (see <a href="pronto.html#prontodtn">5.2</a>)</p></li>
<li><p>Create a new R script with the following lines of code:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="batch-jobs.html#cb9-1" aria-hidden="true" tabindex="-1"></a>a <span class="ot">=</span> <span class="dv">5</span></span>
<span id="cb9-2"><a href="batch-jobs.html#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(a)</span></code></pre></div>
<p>Save the script as <code>basic.R</code>. Copy the script to your csafe-lab work folder.</p></li>
<li><p>Create a text file for Slurm with the following text:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb10-1"><a href="batch-jobs.html#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb10-2"><a href="batch-jobs.html#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="batch-jobs.html#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --nodes=1 # request one node</span></span>
<span id="cb10-4"><a href="batch-jobs.html#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --cpus-per-task=1  # ask for 1 cpu</span></span>
<span id="cb10-5"><a href="batch-jobs.html#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --mem=1G #  asks for 1 GB of RAM</span></span>
<span id="cb10-6"><a href="batch-jobs.html#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --time=00:30:02 # ask that the job be allowed to run for 30 minutes and 2 seconds.</span></span>
<span id="cb10-7"><a href="batch-jobs.html#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="batch-jobs.html#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co"># everything below this line is optional</span></span>
<span id="cb10-9"><a href="batch-jobs.html#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --output=/work/LAS/csafe-lab/your_netid/job_%J_out.txt # store console output</span></span>
<span id="cb10-10"><a href="batch-jobs.html#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --error=/work/LAS/csafe-lab/your_netid/job_%J_err.txt # store error messages</span></span>
<span id="cb10-11"><a href="batch-jobs.html#cb10-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-12"><a href="batch-jobs.html#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="ex">module</span> load r</span>
<span id="cb10-13"><a href="batch-jobs.html#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /work/LAS/csafe-lab/your_netid</span>
<span id="cb10-14"><a href="batch-jobs.html#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="ex">R</span> <span class="at">--save</span> <span class="op">&lt;</span> basic.R</span></code></pre></div>
<p>Save the file as <code>basic.txt</code>.</p></li>
<li><p>(Windows Only) If you are using Windows, your text file will likely have DOS line breaks instead of UNIX line breaks which will cause an error when the file is run on Pronto. Open Terminal in RStudio, use <code>cd folder/containing/text_file</code> to change directories to the folder containing your text file, and type <code>dos2unix basic.txt</code> to change the line breaks to UNIX format.</p></li>
<li><p>Copy the text file to your csafe-lab work folder.</p></li>
<li><p>In the command line prompt where you are connected to Pronto, type</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb11-1"><a href="batch-jobs.html#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sbatch /work/LAS/csafe-lab/your_netid/basic.txt</span></code></pre></div>
<p>This will add your job to the queue. The script is so short, your job will probably run immediately.</p></li>
<li><p>Two new files – <code>job_&lt;job#&gt;_err.txt</code> and <code>job_&lt;job#&gt;_out.txt</code> – should appear in your csafe-lab work folder. If <code>basic.R</code> ran successfully, the <code>job_&lt;job#&gt;_out</code> file should contain</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb12-1"><a href="batch-jobs.html#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> a <span class="ex">=</span> 5</span>
<span id="cb12-2"><a href="batch-jobs.html#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> print<span class="kw">(</span><span class="ex">a</span><span class="kw">)</span></span>
<span id="cb12-3"><a href="batch-jobs.html#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="ex">[1]</span> 5</span>
<span id="cb12-4"><a href="batch-jobs.html#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> </span></code></pre></div>
<p>and <code>job_&lt;job#&gt;_err.txt</code> should be blank. If the error file isn’t blank, troubleshoot the error(s). If you get stuck, email <a href="mailto:researchit@iastate.edu" class="email">researchit@iastate.edu</a>.</p></li>
</ol>
</div>
<div id="ex-save" class="section level2" number="8.2">
<h2><span class="header-section-number">8.2</span> Example: Save a dataframe to a CSV file</h2>
<p>In this example, I will show you how to save a dataframe to a csv file.</p>
<ol style="list-style-type: decimal">
<li><p>If you are off campus, connect to the ISU VPN (see <a href="#signin-vpn"><strong>??</strong></a>)</p></li>
<li><p>Sign-in to Pronto (see <a href="pronto.html#pronto">5</a>).</p></li>
<li><p>Open your csafe-lab work folder <code>prontodtn.las.iastate.edu &gt; work &gt; LAS &gt; csafe-lab &gt; your_netid</code> (see <a href="pronto.html#prontodtn">5.2</a>)</p></li>
<li><p>Create a new R script with the following lines of code:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="batch-jobs.html#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># draw 10 samples from normal distribution</span></span>
<span id="cb13-2"><a href="batch-jobs.html#cb13-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="dv">10</span>)</span>
<span id="cb13-3"><a href="batch-jobs.html#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="batch-jobs.html#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># put in a dataframe</span></span>
<span id="cb13-5"><a href="batch-jobs.html#cb13-5" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">x=</span>data)</span>
<span id="cb13-6"><a href="batch-jobs.html#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="batch-jobs.html#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co"># save dataframe</span></span>
<span id="cb13-8"><a href="batch-jobs.html#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(df, <span class="st">&quot;data.csv&quot;</span>)</span></code></pre></div>
<p>Save the script as <code>dataframe.R</code>. Copy the script to your csafe-lab work folder.</p></li>
<li><p>Create a text file for Slurm with the following text:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb14-1"><a href="batch-jobs.html#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb14-2"><a href="batch-jobs.html#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="batch-jobs.html#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --nodes=1 # request one node</span></span>
<span id="cb14-4"><a href="batch-jobs.html#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --cpus-per-task=1  # ask for 1 cpu</span></span>
<span id="cb14-5"><a href="batch-jobs.html#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --mem=1G #  asks for 1 GB of RAM</span></span>
<span id="cb14-6"><a href="batch-jobs.html#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --time=00:30:02 # ask that the job be allowed to run for 30 minutes and 2 seconds.</span></span>
<span id="cb14-7"><a href="batch-jobs.html#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="batch-jobs.html#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="co"># everything below this line is optional</span></span>
<span id="cb14-9"><a href="batch-jobs.html#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --output=/work/LAS/csafe-lab/your_netid/job_%J_out.txt # store console output</span></span>
<span id="cb14-10"><a href="batch-jobs.html#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --error=/work/LAS/csafe-lab/your_netid/job_%J_err.txt # store error messages</span></span>
<span id="cb14-11"><a href="batch-jobs.html#cb14-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-12"><a href="batch-jobs.html#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="ex">module</span> load r</span>
<span id="cb14-13"><a href="batch-jobs.html#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /work/LAS/csafe-lab/your_netid</span>
<span id="cb14-14"><a href="batch-jobs.html#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="ex">R</span> <span class="at">--save</span> <span class="op">&lt;</span> dataframe.R</span></code></pre></div>
<p>Save the file as <code>dataframe.txt</code>.</p></li>
<li><p>(Windows Only) If you are using Windows, your text file will likely have DOS line breaks instead of UNIX line breaks which will cause an error when the file is run on Pronto. Open Terminal in RStudio, use <code>cd folder/containing/text_file</code> to change directories to the folder containing your text file, and type <code>dos2unix dataframe.txt</code> to change the line breaks to UNIX format.</p></li>
<li><p>Copy the text file to your csafe-lab work folder.</p></li>
<li><p>In the command line prompt where you are connected to Pronto, type</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb15-1"><a href="batch-jobs.html#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sbatch /work/LAS/csafe-lab/your_netid/dataframe.txt</span></code></pre></div>
<p>This will add your job to the queue. The script is so short, your job will probably run immediately.</p></li>
<li><p>The dataframe should be saved in a file <code>data.csv</code> in your csafe-lab work folder. There should be two other new files – <code>data.csv</code>, <code>job_&lt;job#&gt;_err.txt</code> and <code>job_&lt;job#&gt;_out.txt</code> – in your csafe-lab work folder as well. If the error file isn’t blank, troubleshoot the error(s). If you get stuck, email <a href="mailto:researchit@iastate.edu" class="email">researchit@iastate.edu</a>.</p></li>
</ol>
</div>
<div id="ex-load" class="section level2" number="8.3">
<h2><span class="header-section-number">8.3</span> Example: Load data from a CSV file</h2>
<p>In this example, we will load the csv file <code>data.csv</code> that we saved in Example <a href="batch-jobs.html#ex-save">8.2</a>.</p>
<ol style="list-style-type: decimal">
<li><p>If you are off campus, connect to the ISU VPN (see <a href="#signin-vpn"><strong>??</strong></a>)</p></li>
<li><p>Sign-in to Pronto (see <a href="pronto.html#pronto">5</a>).</p></li>
<li><p>Open your csafe-lab work folder <code>prontodtn.las.iastate.edu &gt; work &gt; LAS &gt; csafe-lab &gt; your_netid</code> (see <a href="pronto.html#prontodtn">5.2</a>)</p></li>
<li><p>Double-check that the file <code>data.csv</code> is still in your csafe-lab work folder. If you deleted it, follow the steps in example <a href="batch-jobs.html#ex-save">8.2</a> to recreate it.</p></li>
<li><p>Create a new R script with the following lines of code:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="batch-jobs.html#cb16-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">&quot;data.csv&quot;</span>)</span>
<span id="cb16-2"><a href="batch-jobs.html#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df)</span></code></pre></div>
<p>Save the script as <code>load.R</code> and copy it to you csafe-lab work folder.</p></li>
<li><p>Create a text file for Slurm with the following text:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb17-1"><a href="batch-jobs.html#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb17-2"><a href="batch-jobs.html#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="batch-jobs.html#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --nodes=1 # request one node</span></span>
<span id="cb17-4"><a href="batch-jobs.html#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --cpus-per-task=1  # ask for 1 cpu</span></span>
<span id="cb17-5"><a href="batch-jobs.html#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --mem=1G #  asks for 1 GB of RAM</span></span>
<span id="cb17-6"><a href="batch-jobs.html#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --time=00:30:02 # ask that the job be allowed to run for 30 minutes and 2 seconds.</span></span>
<span id="cb17-7"><a href="batch-jobs.html#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="batch-jobs.html#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="co"># everything below this line is optional</span></span>
<span id="cb17-9"><a href="batch-jobs.html#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --output=/work/LAS/csafe-lab/your_netid/job_%J_out.txt # store console output</span></span>
<span id="cb17-10"><a href="batch-jobs.html#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --error=/work/LAS/csafe-lab/your_netid/job_%J_err.txt # store error messages</span></span>
<span id="cb17-11"><a href="batch-jobs.html#cb17-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-12"><a href="batch-jobs.html#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="ex">module</span> load r</span>
<span id="cb17-13"><a href="batch-jobs.html#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /work/LAS/csafe-lab/your_netid</span>
<span id="cb17-14"><a href="batch-jobs.html#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="ex">R</span> <span class="at">--save</span> <span class="op">&lt;</span> load.R</span></code></pre></div>
<p>Save the file as <code>load.txt</code>.</p></li>
<li><p>(Windows Only) If you are using Windows, your text file will likely have DOS line breaks instead of UNIX line breaks which will cause an error when the file is run on Pronto. Open Terminal in RStudio, use <code>cd folder/containing/text_file</code> to change directories to the folder containing your text file, and type <code>dos2unix load.txt</code> to change the line breaks to UNIX format.</p></li>
<li><p>Copy the text file to your csafe-lab work folder.</p></li>
<li><p>In the command line prompt where you are connected to Pronto, type</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb18-1"><a href="batch-jobs.html#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sbatch /work/LAS/csafe-lab/your_netid/load.txt</span></code></pre></div>
<p>This will add your job to the queue. The script is so short, your job will probably run immediately.</p></li>
<li><p>Open the file <code>job_&lt;job#&gt;_out.txt</code> in your csafe-lab work folder and make sure that the first six lines of the dataframe were printed.</p></li>
</ol>
</div>
<div id="ex-batch-install" class="section level2" number="8.4">
<h2><span class="header-section-number">8.4</span> Example: Install R packages</h2>
<p>Just like in Rstudio on your local machine, you will need to install any R packages that you want use. In this example, we will install futile.logger, doParallel, doRNG, and tidyverse so that we can use these packages in future examples.</p>
<ol style="list-style-type: decimal">
<li><p>If you are off campus, connect to the ISU VPN (see <a href="#signin-vpn"><strong>??</strong></a>)</p></li>
<li><p>Sign-in to Pronto (see <a href="pronto.html#pronto">5</a>).</p></li>
<li><p>Open your csafe-lab work folder <code>prontodtn.las.iastate.edu &gt; work &gt; LAS &gt; csafe-lab &gt; your_netid</code> (see <a href="pronto.html#prontodtn">5.2</a>)</p></li>
<li><p>Create a new R script with the following lines of code:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="batch-jobs.html#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="fu">c</span>(<span class="st">&quot;futile.logger&quot;</span>, </span>
<span id="cb19-2"><a href="batch-jobs.html#cb19-2" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;doParallel&quot;</span>, </span>
<span id="cb19-3"><a href="batch-jobs.html#cb19-3" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;doRNG&quot;</span>,</span>
<span id="cb19-4"><a href="batch-jobs.html#cb19-4" aria-hidden="true" tabindex="-1"></a>                   <span class="st">&quot;tidyverse&quot;</span>), </span>
<span id="cb19-5"><a href="batch-jobs.html#cb19-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">lib=</span><span class="st">&quot;/work/LAS/csafe-lab/your_netid/Rlibs&quot;</span>, </span>
<span id="cb19-6"><a href="batch-jobs.html#cb19-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">repos=</span><span class="st">&quot;https://mirror.las.iastate.edu/CRAN&quot;</span>)</span></code></pre></div>
<p>The line starting with <code>lib=</code> tells Pronto to install the R packages in your csafe-lab work folder. The line starting with <code>repos=</code> tells Pronto which CRAN mirror to use. ResearchIT says that these two lines should always be used [<a href="https://researchit.las.iastate.edu/how-run-r-pronto" class="uri">https://researchit.las.iastate.edu/how-run-r-pronto</a>]. Save the script as <code>install_packages.R</code>. Copy the script to your csafe-lab work folder.</p></li>
<li><p>Create a text file for Slurm with the following text:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb20-1"><a href="batch-jobs.html#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb20-2"><a href="batch-jobs.html#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="batch-jobs.html#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --nodes=1 # request one node</span></span>
<span id="cb20-4"><a href="batch-jobs.html#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --cpus-per-task=1  # ask for 1 cpu</span></span>
<span id="cb20-5"><a href="batch-jobs.html#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --mem=1G #  asks for 1 GB of RAM</span></span>
<span id="cb20-6"><a href="batch-jobs.html#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --time=00:30:02 # ask that the job be allowed to run for 30 minutes and 2 seconds.</span></span>
<span id="cb20-7"><a href="batch-jobs.html#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="batch-jobs.html#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="co"># everything below this line is optional</span></span>
<span id="cb20-9"><a href="batch-jobs.html#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --output=/work/LAS/csafe-lab/your_netid/job_%J_out.txt # store console output</span></span>
<span id="cb20-10"><a href="batch-jobs.html#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --error=/work/LAS/csafe-lab/your_netid/job_%J_err.txt # store error messages</span></span>
<span id="cb20-11"><a href="batch-jobs.html#cb20-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-12"><a href="batch-jobs.html#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">R_LIBS_USER</span><span class="op">=</span>/work/LAS/csafe-lab/your_netid/Rlibs</span>
<span id="cb20-13"><a href="batch-jobs.html#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="fu">mkdir</span> <span class="at">-p</span> <span class="va">$R_LIBS_USER</span></span>
<span id="cb20-14"><a href="batch-jobs.html#cb20-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-15"><a href="batch-jobs.html#cb20-15" aria-hidden="true" tabindex="-1"></a><span class="ex">module</span> load r</span>
<span id="cb20-16"><a href="batch-jobs.html#cb20-16" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /work/LAS/csafe-lab/your_netid</span>
<span id="cb20-17"><a href="batch-jobs.html#cb20-17" aria-hidden="true" tabindex="-1"></a><span class="ex">R</span> <span class="at">--save</span> <span class="op">&lt;</span> install_packages.R</span></code></pre></div>
<p>Save the file as <code>install_packages.txt</code>.</p></li>
<li><p>(Windows Only) If you are using Windows, your text file will likely have DOS line breaks instead of UNIX line breaks which will cause an error when the file is run on Pronto. Open Terminal in RStudio, use <code>cd folder/containing/text_file</code> to change directories to the folder containing your text file, and type <code>dos2unix install_packages.txt</code> to change the line breaks to UNIX format.</p></li>
<li><p>Copy the text file to your csafe-lab work folder.</p></li>
<li><p>In the command line prompt where you are connected to Pronto, type</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb21-1"><a href="batch-jobs.html#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sbatch /work/LAS/csafe-lab/your_netid/install_packages.txt</span></code></pre></div>
<p>This will add your job to the queue. Just like on your local machine, it might take several minutes to install the packages.</p></li>
<li><p>There should be two other new files – <code>data.csv</code>, <code>job_&lt;job#&gt;_err.txt</code> and <code>job_&lt;job#&gt;_out.txt</code> – in your csafe-lab work folder.</p></li>
</ol>
</div>
<div id="ex-parallel" class="section level2" number="8.5">
<h2><span class="header-section-number">8.5</span> Example: Run code in parallel</h2>
<p>The main benefit of Pronto is that it can run code in parallel. In this example, I will show you how to run a for loop in parallel using the doParallel library. R has other packages for parallel computing, but ResearchIT uses doParallel in their how-to [<a href="https://researchit.las.iastate.edu/how-run-r-pronto" class="uri">https://researchit.las.iastate.edu/how-run-r-pronto</a>] so that’s what I will use here.</p>
<p>If you completed Example <a href="batch-jobs.html#ex-batch-install">8.4</a> the doParallel package will already be installed. If you need to install the doParallel package see Examples <a href="interactive-sessions.html#ex-interactive-install">7.2</a> or <a href="batch-jobs.html#ex-batch-install">8.4</a> for instructions.</p>
<ol style="list-style-type: decimal">
<li><p>If you are off campus, connect to the ISU VPN (see <a href="#signin-vpn"><strong>??</strong></a>)</p></li>
<li><p>Sign-in to Pronto (see <a href="pronto.html#pronto">5</a>).</p></li>
<li><p>Open your csafe-lab work folder <code>prontodtn.las.iastate.edu &gt; work &gt; LAS &gt; csafe-lab &gt; your_netid</code> (see <a href="pronto.html#prontodtn">5.2</a>)</p></li>
<li><p>Create a new R script with the following lines of code:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="batch-jobs.html#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(doParallel)</span>
<span id="cb22-2"><a href="batch-jobs.html#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="batch-jobs.html#cb22-3" aria-hidden="true" tabindex="-1"></a>nCores <span class="ot">=</span> <span class="fu">as.integer</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;SLURM_CPUS_PER_TASK&quot;</span>))</span>
<span id="cb22-4"><a href="batch-jobs.html#cb22-4" aria-hidden="true" tabindex="-1"></a>myCluster <span class="ot">=</span> parallel<span class="sc">::</span><span class="fu">makeCluster</span>(nCores)</span>
<span id="cb22-5"><a href="batch-jobs.html#cb22-5" aria-hidden="true" tabindex="-1"></a>doParallel<span class="sc">::</span><span class="fu">registerDoParallel</span>(myCluster)</span>
<span id="cb22-6"><a href="batch-jobs.html#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="batch-jobs.html#cb22-7" aria-hidden="true" tabindex="-1"></a>results <span class="ot">=</span> <span class="fu">foreach</span>(<span class="at">i=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) <span class="sc">%dopar%</span> {</span>
<span id="cb22-8"><a href="batch-jobs.html#cb22-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rnorm</span>(<span class="dv">1000</span>)}</span>
<span id="cb22-9"><a href="batch-jobs.html#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(results, <span class="st">&quot;parallel_results.rds&quot;</span>)</span></code></pre></div>
<p>Save the script as <code>parallel.R</code>. Copy the script to your csafe-lab work folder.</p></li>
<li><p>Create a text file for Slurm with the following text:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb23-1"><a href="batch-jobs.html#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb23-2"><a href="batch-jobs.html#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="batch-jobs.html#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --nodes=1 # request one node</span></span>
<span id="cb23-4"><a href="batch-jobs.html#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --cpus-per-task=10  # ask for 10 cpu</span></span>
<span id="cb23-5"><a href="batch-jobs.html#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --mem=1G #  asks for 1 GB of RAM</span></span>
<span id="cb23-6"><a href="batch-jobs.html#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --time=00:30:02 # ask that the job be allowed to run for 30 minutes and 2 seconds.</span></span>
<span id="cb23-7"><a href="batch-jobs.html#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="batch-jobs.html#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="co"># everything below this line is optional</span></span>
<span id="cb23-9"><a href="batch-jobs.html#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --output=/work/LAS/csafe-lab/your_netid/job_%J_out.txt # store console output</span></span>
<span id="cb23-10"><a href="batch-jobs.html#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --error=/work/LAS/csafe-lab/your_netid/job_%J_err.txt # store error messages</span></span>
<span id="cb23-11"><a href="batch-jobs.html#cb23-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-12"><a href="batch-jobs.html#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">R_LIBS_USER</span><span class="op">=</span>/work/LAS/csafe-lab/your_netid/Rlibs</span>
<span id="cb23-13"><a href="batch-jobs.html#cb23-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-14"><a href="batch-jobs.html#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="ex">module</span> load r</span>
<span id="cb23-15"><a href="batch-jobs.html#cb23-15" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /work/LAS/csafe-lab/your_netid</span>
<span id="cb23-16"><a href="batch-jobs.html#cb23-16" aria-hidden="true" tabindex="-1"></a><span class="ex">R</span> <span class="at">--save</span> <span class="op">&lt;</span> parallel.R</span></code></pre></div>
<p>Save the file as <code>parallel.txt</code>.</p></li>
<li><p>(Windows Only) If you are using Windows, your text file will likely have DOS line breaks instead of UNIX line breaks which will cause an error when the file is run on Pronto. Open Terminal in RStudio, use <code>cd folder/containing/text_file</code> to change directories to the folder containing your text file, and type <code>dos2unix parallel.txt</code> to change the line breaks to UNIX format.</p></li>
<li><p>Copy the text file to your csafe-lab work folder.</p></li>
<li><p>In the command line prompt where you are connected to Pronto, type</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb24-1"><a href="batch-jobs.html#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sbatch /work/LAS/csafe-lab/your_netid/parallel.txt</span></code></pre></div></li>
<li><p>The results of the parallel loop should be saved in <code>parallel.txt</code> in your csafe-lab work folder.</p></li>
</ol>
</div>
<div id="ex-seed" class="section level2" number="8.6">
<h2><span class="header-section-number">8.6</span> Example: Set the seed for the random number generator</h2>
<p>If you run Example <a href="batch-jobs.html#ex-parallel">8.5</a> multiple times, the numbers sampled from the normal distribution will likely be different each time. If you want to make the sample reproducible
(produce the same sample each time), set the seed for the random number generator. The most common way to set a seed is with the <code>set.seed()</code> function. This function does not work with <code>%dopar%</code> from the doParallel package, but it does work with <code>%dorng%</code>.</p>
<ol style="list-style-type: decimal">
<li><p>If you are off campus, connect to the ISU VPN (see <a href="#signin-vpn"><strong>??</strong></a>)</p></li>
<li><p>Sign-in to Pronto (see <a href="pronto.html#pronto">5</a>).</p></li>
<li><p>Open your csafe-lab work folder <code>prontodtn.las.iastate.edu &gt; work &gt; LAS &gt; csafe-lab &gt; your_netid</code> (see <a href="pronto.html#prontodtn">5.2</a>)</p></li>
<li><p>Create a new R script with the following lines of code:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="batch-jobs.html#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(doParallel)</span>
<span id="cb25-2"><a href="batch-jobs.html#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(doRNG)</span>
<span id="cb25-3"><a href="batch-jobs.html#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="batch-jobs.html#cb25-4" aria-hidden="true" tabindex="-1"></a>nCores <span class="ot">=</span> <span class="fu">as.integer</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;SLURM_CPUS_PER_TASK&quot;</span>))</span>
<span id="cb25-5"><a href="batch-jobs.html#cb25-5" aria-hidden="true" tabindex="-1"></a>myCluster <span class="ot">=</span> parallel<span class="sc">::</span><span class="fu">makeCluster</span>(nCores)</span>
<span id="cb25-6"><a href="batch-jobs.html#cb25-6" aria-hidden="true" tabindex="-1"></a>doParallel<span class="sc">::</span><span class="fu">registerDoParallel</span>(myCluster)</span>
<span id="cb25-7"><a href="batch-jobs.html#cb25-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-8"><a href="batch-jobs.html#cb25-8" aria-hidden="true" tabindex="-1"></a>starting_seed <span class="ot">=</span> <span class="dv">300</span></span>
<span id="cb25-9"><a href="batch-jobs.html#cb25-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-10"><a href="batch-jobs.html#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(starting_seed)</span>
<span id="cb25-11"><a href="batch-jobs.html#cb25-11" aria-hidden="true" tabindex="-1"></a>r1 <span class="ot">=</span> <span class="fu">foreach</span>(<span class="at">i=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>) <span class="sc">%dorng%</span>{ <span class="fu">runif</span>(<span class="dv">1</span>) }</span>
<span id="cb25-12"><a href="batch-jobs.html#cb25-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-13"><a href="batch-jobs.html#cb25-13" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(starting_seed)</span>
<span id="cb25-14"><a href="batch-jobs.html#cb25-14" aria-hidden="true" tabindex="-1"></a>r2 <span class="ot">=</span> <span class="fu">foreach</span>(<span class="at">i=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>) <span class="sc">%dorng%</span>{ <span class="fu">runif</span>(<span class="dv">1</span>) }</span>
<span id="cb25-15"><a href="batch-jobs.html#cb25-15" aria-hidden="true" tabindex="-1"></a><span class="fu">identical</span>(r1, r2)</span></code></pre></div>
<p>Save the script as <code>seed.R</code>. Copy the script to your csafe-lab work folder.</p></li>
<li><p>Create a text file for Slurm with the following text:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb26-1"><a href="batch-jobs.html#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb26-2"><a href="batch-jobs.html#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="batch-jobs.html#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --nodes=1 # request one node</span></span>
<span id="cb26-4"><a href="batch-jobs.html#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --cpus-per-task=10  # ask for 10 cpu</span></span>
<span id="cb26-5"><a href="batch-jobs.html#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --mem=1G #  asks for 1 GB of RAM</span></span>
<span id="cb26-6"><a href="batch-jobs.html#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --time=00:30:02 # ask that the job be allowed to run for 30 minutes and 2 seconds.</span></span>
<span id="cb26-7"><a href="batch-jobs.html#cb26-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-8"><a href="batch-jobs.html#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="co"># everything below this line is optional</span></span>
<span id="cb26-9"><a href="batch-jobs.html#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --output=/work/LAS/csafe-lab/your_netid/job_%J_out.txt # store console output</span></span>
<span id="cb26-10"><a href="batch-jobs.html#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --error=/work/LAS/csafe-lab/your_netid/job_%J_err.txt # store error messages</span></span>
<span id="cb26-11"><a href="batch-jobs.html#cb26-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-12"><a href="batch-jobs.html#cb26-12" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">R_LIBS_USER</span><span class="op">=</span>/work/LAS/csafe-lab/your_netid/Rlibs</span>
<span id="cb26-13"><a href="batch-jobs.html#cb26-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-14"><a href="batch-jobs.html#cb26-14" aria-hidden="true" tabindex="-1"></a><span class="ex">module</span> load r</span>
<span id="cb26-15"><a href="batch-jobs.html#cb26-15" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /work/LAS/csafe-lab/your_netid</span>
<span id="cb26-16"><a href="batch-jobs.html#cb26-16" aria-hidden="true" tabindex="-1"></a><span class="ex">R</span> <span class="at">--save</span> <span class="op">&lt;</span> seed.R</span></code></pre></div>
<p>Save the file as <code>seed.txt</code>.</p></li>
<li><p>(Windows Only) If you are using Windows, your text file will likely have DOS line breaks instead of UNIX line breaks which will cause an error when the file is run on Pronto. Open Terminal in RStudio, use <code>cd folder/containing/text_file</code> to change directories to the folder containing your text file, and type <code>dos2unix seed.txt</code> to change the line breaks to UNIX format.</p></li>
<li><p>Copy the text file to your csafe-lab work folder.</p></li>
<li><p>In the command line prompt where you are connected to Pronto, type</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb27-1"><a href="batch-jobs.html#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sbatch /work/LAS/csafe-lab/your_netid/seed.txt</span></code></pre></div></li>
<li><p>Open the <code>job_&lt;job#&gt;_out.txt</code> file to make sure that the result of <code>identical(r1, r2)</code> is <code>TRUE</code>.</p></li>
</ol>
</div>
<div id="ex-packages-parallel" class="section level2" number="8.7">
<h2><span class="header-section-number">8.7</span> Example: Use functions from dplyr and magrittr in parallel</h2>
<p>The previous parallel examples used the base R functions <code>rnorm</code> and <code>runif</code>. If we want to use
functions from packages that we install, we need to pass the package names to the <code>%dorng%</code> operator. We will learn how to do this in this example.</p>
<p>If you haven’t already installed the <code>tidyverse</code> package, follow the steps in Example 4 to install the <code>tidyverse</code> or install <code>dplyr</code> and <code>magrittr</code> separately.</p>
<ol style="list-style-type: decimal">
<li><p>If you are off campus, connect to the ISU VPN (see <a href="#signin-vpn"><strong>??</strong></a>)</p></li>
<li><p>Sign-in to Pronto (see <a href="pronto.html#pronto">5</a>).</p></li>
<li><p>Open your csafe-lab work folder <code>prontodtn.las.iastate.edu &gt; work &gt; LAS &gt; csafe-lab &gt; your_netid</code> (see <a href="pronto.html#prontodtn">5.2</a>)</p></li>
<li><p>Create a new R script with the following lines of code:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="batch-jobs.html#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(doParallel)</span>
<span id="cb28-2"><a href="batch-jobs.html#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(doRNG)</span>
<span id="cb28-3"><a href="batch-jobs.html#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb28-4"><a href="batch-jobs.html#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb28-5"><a href="batch-jobs.html#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="batch-jobs.html#cb28-6" aria-hidden="true" tabindex="-1"></a>nCores <span class="ot">=</span> <span class="fu">as.integer</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;SLURM_CPUS_PER_TASK&quot;</span>))</span>
<span id="cb28-7"><a href="batch-jobs.html#cb28-7" aria-hidden="true" tabindex="-1"></a>myCluster <span class="ot">=</span> parallel<span class="sc">::</span><span class="fu">makeCluster</span>(nCores)</span>
<span id="cb28-8"><a href="batch-jobs.html#cb28-8" aria-hidden="true" tabindex="-1"></a>doParallel<span class="sc">::</span><span class="fu">registerDoParallel</span>(myCluster)</span>
<span id="cb28-9"><a href="batch-jobs.html#cb28-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-10"><a href="batch-jobs.html#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">100</span>)</span>
<span id="cb28-11"><a href="batch-jobs.html#cb28-11" aria-hidden="true" tabindex="-1"></a>r1 <span class="ot">=</span> <span class="fu">foreach</span>(<span class="at">i=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">.packages=</span><span class="fu">c</span>(<span class="st">&quot;dplyr&quot;</span>, <span class="st">&quot;magrittr&quot;</span>)) <span class="sc">%dorng%</span>{ </span>
<span id="cb28-12"><a href="batch-jobs.html#cb28-12" aria-hidden="true" tabindex="-1"></a>  cluster_centers <span class="ot">=</span> df <span class="sc">%&gt;%</span> <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">40</span>)</span>
<span id="cb28-13"><a href="batch-jobs.html#cb28-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb28-14"><a href="batch-jobs.html#cb28-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-15"><a href="batch-jobs.html#cb28-15" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">100</span>)</span>
<span id="cb28-16"><a href="batch-jobs.html#cb28-16" aria-hidden="true" tabindex="-1"></a>r2 <span class="ot">=</span> <span class="fu">foreach</span>(<span class="at">i=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">.packages=</span><span class="fu">c</span>(<span class="st">&quot;dplyr&quot;</span>, <span class="st">&quot;magrittr&quot;</span>)) <span class="sc">%dorng%</span>{ </span>
<span id="cb28-17"><a href="batch-jobs.html#cb28-17" aria-hidden="true" tabindex="-1"></a>  cluster_centers <span class="ot">=</span> df <span class="sc">%&gt;%</span> <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">40</span>)</span>
<span id="cb28-18"><a href="batch-jobs.html#cb28-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb28-19"><a href="batch-jobs.html#cb28-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-20"><a href="batch-jobs.html#cb28-20" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">200</span>)</span>
<span id="cb28-21"><a href="batch-jobs.html#cb28-21" aria-hidden="true" tabindex="-1"></a>r3 <span class="ot">=</span> <span class="fu">foreach</span>(<span class="at">i=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">.packages=</span><span class="fu">c</span>(<span class="st">&quot;dplyr&quot;</span>, <span class="st">&quot;magrittr&quot;</span>)) <span class="sc">%dorng%</span>{ </span>
<span id="cb28-22"><a href="batch-jobs.html#cb28-22" aria-hidden="true" tabindex="-1"></a>  cluster_centers <span class="ot">=</span> df <span class="sc">%&gt;%</span> <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">40</span>)</span>
<span id="cb28-23"><a href="batch-jobs.html#cb28-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb28-24"><a href="batch-jobs.html#cb28-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-25"><a href="batch-jobs.html#cb28-25" aria-hidden="true" tabindex="-1"></a><span class="fu">identical</span>(r1, r2)</span>
<span id="cb28-26"><a href="batch-jobs.html#cb28-26" aria-hidden="true" tabindex="-1"></a><span class="fu">identical</span>(r1, r3)</span></code></pre></div>
<p>Save the script as <code>magrittr.R</code>. Copy the script to your csafe-lab work folder.</p></li>
<li><p>Create a text file for Slurm with the following text:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb29-1"><a href="batch-jobs.html#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb29-2"><a href="batch-jobs.html#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="batch-jobs.html#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --nodes=1 # request one node</span></span>
<span id="cb29-4"><a href="batch-jobs.html#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --cpus-per-task=10  # ask for 10 cpu</span></span>
<span id="cb29-5"><a href="batch-jobs.html#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --mem=1G #  asks for 1 GB of RAM</span></span>
<span id="cb29-6"><a href="batch-jobs.html#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --time=00:30:02 # ask that the job be allowed to run for 30 minutes and 2 seconds.</span></span>
<span id="cb29-7"><a href="batch-jobs.html#cb29-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-8"><a href="batch-jobs.html#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="co"># everything below this line is optional</span></span>
<span id="cb29-9"><a href="batch-jobs.html#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --output=/work/LAS/csafe-lab/your_netid/job_%J_out.txt # store console output</span></span>
<span id="cb29-10"><a href="batch-jobs.html#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --error=/work/LAS/csafe-lab/your_netid/job_%J_err.txt # store error messages</span></span>
<span id="cb29-11"><a href="batch-jobs.html#cb29-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-12"><a href="batch-jobs.html#cb29-12" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">R_LIBS_USER</span><span class="op">=</span>/work/LAS/csafe-lab/your_netid/Rlibs</span>
<span id="cb29-13"><a href="batch-jobs.html#cb29-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-14"><a href="batch-jobs.html#cb29-14" aria-hidden="true" tabindex="-1"></a><span class="ex">module</span> load r</span>
<span id="cb29-15"><a href="batch-jobs.html#cb29-15" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /work/LAS/csafe-lab/your_netid</span>
<span id="cb29-16"><a href="batch-jobs.html#cb29-16" aria-hidden="true" tabindex="-1"></a><span class="ex">R</span> <span class="at">--save</span> <span class="op">&lt;</span> magrittr.R</span></code></pre></div>
<p>Save the file as <code>magrittr.txt</code>.</p></li>
<li><p>(Windows Only) If you are using Windows, your text file will likely have DOS line breaks instead of UNIX line breaks which will cause an error when the file is run on Pronto. Open Terminal in RStudio, use <code>cd folder/containing/text_file</code> to change directories to the folder containing your text file, and type <code>dos2unix magrittr.txt</code> to change the line breaks to UNIX format.</p></li>
<li><p>Copy the text file to your csafe-lab work folder.</p></li>
<li><p>In the command line prompt where you are connected to Pronto, type</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb30-1"><a href="batch-jobs.html#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sbatch /work/LAS/csafe-lab/your_netid/magrittr.txt</span></code></pre></div></li>
<li><p>Open the <code>job_&lt;job#&gt;_out.txt</code> file to make sure that the result of <code>identical(r1, r2)</code> is <code>TRUE</code> and <code>identical(r1, r3)</code> is <code>FALSE</code>.</p></li>
</ol>
</div>
<div id="example-use-a-user-defined-function-to-save-results-inside-a-parallel-loop" class="section level2" number="8.8">
<h2><span class="header-section-number">8.8</span> Example: Use a user-defined function to save results inside a parallel loop</h2>
<ol style="list-style-type: decimal">
<li><p>If you are off campus, connect to the ISU VPN (see <a href="#signin-vpn"><strong>??</strong></a>)</p></li>
<li><p>Sign-in to Pronto (see <a href="pronto.html#pronto">5</a>).</p></li>
<li><p>Open your csafe-lab work folder <code>prontodtn.las.iastate.edu &gt; work &gt; LAS &gt; csafe-lab &gt; your_netid</code> (see <a href="pronto.html#prontodtn">5.2</a>)</p></li>
<li><p>Create a new R script with the following lines of code:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="batch-jobs.html#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(doParallel)</span>
<span id="cb31-2"><a href="batch-jobs.html#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(doRNG)</span>
<span id="cb31-3"><a href="batch-jobs.html#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;parallel_save.R&quot;</span>)</span>
<span id="cb31-4"><a href="batch-jobs.html#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="batch-jobs.html#cb31-5" aria-hidden="true" tabindex="-1"></a>nCores <span class="ot">=</span> <span class="fu">as.integer</span>(<span class="fu">Sys.getenv</span>(<span class="st">&quot;SLURM_CPUS_PER_TASK&quot;</span>))</span>
<span id="cb31-6"><a href="batch-jobs.html#cb31-6" aria-hidden="true" tabindex="-1"></a>myCluster <span class="ot">=</span> parallel<span class="sc">::</span><span class="fu">makeCluster</span>(nCores)</span>
<span id="cb31-7"><a href="batch-jobs.html#cb31-7" aria-hidden="true" tabindex="-1"></a>doParallel<span class="sc">::</span><span class="fu">registerDoParallel</span>(myCluster)</span>
<span id="cb31-8"><a href="batch-jobs.html#cb31-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-9"><a href="batch-jobs.html#cb31-9" aria-hidden="true" tabindex="-1"></a>starting_seed <span class="ot">=</span> <span class="dv">300</span></span>
<span id="cb31-10"><a href="batch-jobs.html#cb31-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-11"><a href="batch-jobs.html#cb31-11" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(starting_seed)</span>
<span id="cb31-12"><a href="batch-jobs.html#cb31-12" aria-hidden="true" tabindex="-1"></a>r1 <span class="ot">=</span> <span class="fu">foreach</span>(<span class="at">i=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) <span class="sc">%dorng%</span> {</span>
<span id="cb31-13"><a href="batch-jobs.html#cb31-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">save_sample</span>(<span class="at">n=</span><span class="dv">10000</span>, <span class="at">filename=</span><span class="fu">paste0</span>(<span class="st">&quot;sample_&quot;</span>,i,<span class="st">&quot;.rds&quot;</span>)) </span>
<span id="cb31-14"><a href="batch-jobs.html#cb31-14" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Save the script as <code>run_parallel_save.R</code>. Copy the script to your csafe-lab work folder.</p></li>
<li><p>Create a text file for Slurm with the following text:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="batch-jobs.html#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb32-2"><a href="batch-jobs.html#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="batch-jobs.html#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --nodes=1 # request one node</span></span>
<span id="cb32-4"><a href="batch-jobs.html#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --cpus-per-task=10</span></span>
<span id="cb32-5"><a href="batch-jobs.html#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --mem=2G </span></span>
<span id="cb32-6"><a href="batch-jobs.html#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --time=00:15:00</span></span>
<span id="cb32-7"><a href="batch-jobs.html#cb32-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-8"><a href="batch-jobs.html#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="co"># everything below this line is optional</span></span>
<span id="cb32-9"><a href="batch-jobs.html#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --output=/work/LAS/csafe-lab/your_netid/job_%J_out.txt # store console output</span></span>
<span id="cb32-10"><a href="batch-jobs.html#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --error=/work/LAS/csafe-lab/your_netid/job_%J_err.txt # store error messages</span></span>
<span id="cb32-11"><a href="batch-jobs.html#cb32-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-12"><a href="batch-jobs.html#cb32-12" aria-hidden="true" tabindex="-1"></a>export R_LIBS_USER<span class="ot">=</span><span class="er">/</span>work<span class="sc">/</span>LAS<span class="sc">/</span>csafe<span class="sc">-</span>lab<span class="sc">/</span>your_netid<span class="sc">/</span>Rlibs</span>
<span id="cb32-13"><a href="batch-jobs.html#cb32-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-14"><a href="batch-jobs.html#cb32-14" aria-hidden="true" tabindex="-1"></a>module load r</span>
<span id="cb32-15"><a href="batch-jobs.html#cb32-15" aria-hidden="true" tabindex="-1"></a>cd <span class="sc">/</span>work<span class="sc">/</span>LAS<span class="sc">/</span>csafe<span class="sc">-</span>lab<span class="sc">/</span>your_netid</span>
<span id="cb32-16"><a href="batch-jobs.html#cb32-16" aria-hidden="true" tabindex="-1"></a>R <span class="sc">--</span>save <span class="sc">&lt;</span> run_parallel_save.R</span></code></pre></div>
<p>Save the file as <code>parallel_save.txt</code>.</p></li>
<li><p>(Windows Only) If you are using Windows, your text file will likely have DOS line breaks instead of UNIX line breaks which will cause an error when the file is run on Pronto. Open Terminal in RStudio, use <code>cd folder/containing/text_file</code> to change directories to the folder containing your text file, and type <code>dos2unix parallel_save.txt</code> to change the line breaks to UNIX format.</p></li>
<li><p>Copy the text file to your csafe-lab work folder.</p></li>
<li><p>In the command line prompt where you are connected to Pronto, type</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb33-1"><a href="batch-jobs.html#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sbatch /work/LAS/csafe-lab/your_netid/parallel_save.txt</span></code></pre></div></li>
<li><p>There should be ten rds files names sample_1.rds, sample_2.rds, etc. in your csafe-lab folder.</p></li>
</ol>
</div>
<div id="ex-log" class="section level2" number="8.9">
<h2><span class="header-section-number">8.9</span> Example: Create a log file</h2>
<p>In this example we will create a simple log file using the <code>futile.logger</code> package.</p>
<ol style="list-style-type: decimal">
<li><p>If you are off campus, connect to the ISU VPN (see <a href="#signin-vpn"><strong>??</strong></a>)</p></li>
<li><p>Sign-in to Pronto (see <a href="pronto.html#pronto">5</a>).</p></li>
<li><p>Open your csafe-lab work folder <code>prontodtn.las.iastate.edu &gt; work &gt; LAS &gt; csafe-lab &gt; your_netid</code> (see <a href="pronto.html#prontodtn">5.2</a>)</p></li>
<li><p>Create a new R script with the following lines of code:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="batch-jobs.html#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(futile.logger)</span>
<span id="cb34-2"><a href="batch-jobs.html#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="batch-jobs.html#cb34-3" aria-hidden="true" tabindex="-1"></a>futile.logger<span class="sc">::</span><span class="fu">flog.appender</span>(<span class="fu">appender.file</span>(<span class="st">&quot;log_file.txt&quot;</span>), <span class="at">name=</span><span class="st">&#39;log&#39;</span>)</span>
<span id="cb34-4"><a href="batch-jobs.html#cb34-4" aria-hidden="true" tabindex="-1"></a>futile.logger<span class="sc">::</span><span class="fu">flog.info</span>(<span class="st">&quot;start script...&quot;</span>, <span class="at">name=</span><span class="st">&#39;log&#39;</span>)</span>
<span id="cb34-5"><a href="batch-jobs.html#cb34-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-6"><a href="batch-jobs.html#cb34-6" aria-hidden="true" tabindex="-1"></a>a <span class="ot">=</span> <span class="dv">5</span></span>
<span id="cb34-7"><a href="batch-jobs.html#cb34-7" aria-hidden="true" tabindex="-1"></a>futile.logger<span class="sc">::</span><span class="fu">flog.info</span>(<span class="st">&quot;variable a = %d&quot;</span>, a, <span class="at">name=</span><span class="st">&#39;log&#39;</span>)</span></code></pre></div>
<p>Save the script as <code>log.R</code>. Copy the script to your csafe-lab work folder.</p></li>
<li><p>Create a text file for Slurm with the following text:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb35-1"><a href="batch-jobs.html#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb35-2"><a href="batch-jobs.html#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="batch-jobs.html#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --nodes=1 # request one node</span></span>
<span id="cb35-4"><a href="batch-jobs.html#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --cpus-per-task=10  # ask for 10 cpu</span></span>
<span id="cb35-5"><a href="batch-jobs.html#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --mem=1G #  asks for 1 GB of RAM</span></span>
<span id="cb35-6"><a href="batch-jobs.html#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --time=00:30:02 # ask that the job be allowed to run for 30 minutes and 2 seconds.</span></span>
<span id="cb35-7"><a href="batch-jobs.html#cb35-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-8"><a href="batch-jobs.html#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="co"># everything below this line is optional</span></span>
<span id="cb35-9"><a href="batch-jobs.html#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --output=/work/LAS/csafe-lab/your_netid/job_%J_out.txt # store console output</span></span>
<span id="cb35-10"><a href="batch-jobs.html#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --error=/work/LAS/csafe-lab/your_netid/job_%J_err.txt # store error messages</span></span>
<span id="cb35-11"><a href="batch-jobs.html#cb35-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-12"><a href="batch-jobs.html#cb35-12" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">R_LIBS_USER</span><span class="op">=</span>/work/LAS/csafe-lab/your_netid/Rlibs</span>
<span id="cb35-13"><a href="batch-jobs.html#cb35-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-14"><a href="batch-jobs.html#cb35-14" aria-hidden="true" tabindex="-1"></a><span class="ex">module</span> load r</span>
<span id="cb35-15"><a href="batch-jobs.html#cb35-15" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> /work/LAS/csafe-lab/your_netid</span>
<span id="cb35-16"><a href="batch-jobs.html#cb35-16" aria-hidden="true" tabindex="-1"></a><span class="ex">R</span> <span class="at">--save</span> <span class="op">&lt;</span> log.R</span></code></pre></div>
<p>Save the file as <code>log.txt</code>.</p></li>
<li><p>(Windows Only) If you are using Windows, your text file will likely have DOS line breaks instead of UNIX line breaks which will cause an error when the file is run on Pronto. Open Terminal in RStudio, use <code>cd folder/containing/text_file</code> to change directories to the folder containing your text file, and type <code>dos2unix log.txt</code> to change the line breaks to UNIX format.</p></li>
<li><p>Copy the text file to your csafe-lab work folder.</p></li>
<li><p>In the command line prompt where you are connected to Pronto, type</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb36-1"><a href="batch-jobs.html#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> sbatch /work/LAS/csafe-lab/your_netid/log.txt</span></code></pre></div></li>
<li><p>A log file called <code>log_file.txt</code> should appear in your csafe-lab work folder. The contents of the log should look like</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb37-1"><a href="batch-jobs.html#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="ex">INFO</span> [2022-05-04 10:42:37] start script...</span>
<span id="cb37-2"><a href="batch-jobs.html#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="ex">INFO</span> [2022-05-04 10:42:37] variable a = 5</span></code></pre></div></li>
</ol>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="interactive-sessions.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="pronto-commands.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/04-citations.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
